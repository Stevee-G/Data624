---
title: "Data 624 Homework 5"
author: "Steven Gonzalez"
date: "3/9/2025"
output:
  html_document: default
  pdf_document: default
---

## Load Packages
```{r message=FALSE, warning=FALSE}
library(fpp3)
library(seasonal)
library(USgas)
```

## Exercise 1
Consider the the number of pigs slaughtered in Victoria, available in the `aus_livestock` dataset.

Use the `ETS()` function to estimate the equivalent model for simple exponential smoothing. Find the optimal values of alpha and lo, and generate forecasts for the next four months.
```{r message=FALSE, warning=FALSE}
vic_pigs <- aus_livestock %>%
  filter(!is.na(Count)) %>% 
  filter(State == 'Victoria') %>% 
  filter(Animal == 'Pigs')

pfit <- vic_pigs %>%
  model(SES = ETS(Count ~ error('A') + trend('N') + season('N')))

report(pfit)

pfit %>%
  forecast(h = 4)

pfit %>% 
  forecast(h = 4) %>% 
  autoplot(vic_pigs %>% 
             filter(year(Month) >= 2009))
```



Compute a 95% prediction interval for the first forecast using y ± 1.96s where s is the standard deviation of the residuals. Compare your interval with the interval produced by R.
```{r message=FALSE, warning=FALSE}
pfc <- pfit %>%
  forecast(h = 4)

pfc_s <- sd(augment(pfit)$.resid)

p_lower_limit <- pfc$.mean[1] - (pfc_s*1.96)
p_upper_limit <- pfc$.mean[1] + (pfc_s*1.96)

cat(p_lower_limit, p_upper_limit)

pfc_hilo <- pfc %>%
  hilo()

pfc_hilo$`95%`[1]
```



## Exercise 5
Data set `global_economy` contains the annual Exports from many countries. Select one country to analyse.

Plot the Exports series and discuss the main features of the data.
```{r message=FALSE, warning=FALSE}
global_economy %>%
  as_tibble() %>%
  select(Country) %>%
  unique()

pr_exp <- global_economy %>%
  filter(!is.na(Exports)) %>%
  filter(Country == 'Puerto Rico')

pr_exp %>%
  autoplot(Exports) +
  labs(title = 'Puerto Rico Exports')
```



Use an ETS(A,N,N) model to forecast the series, and plot the forecasts.
```{r message=FALSE, warning=FALSE}
pr_fit <- pr_exp %>%
  model(SES = ETS(Exports ~ error('A') + trend('N') + season('N')))

report(pr_fit)

pr_fit %>% 
  forecast(h = 5) %>% 
  autoplot(pr_exp)
```



Compute the RMSE values for the training data.
```{r message=FALSE, warning=FALSE}
pr_fit %>% 
  accuracy()
```

Compare the results to those from an ETS(A,A,N) model. (Remember that the trended model is using one more parameter than the simpler model.) Discuss the merits of the two forecasting methods for this data set.
```{r message=FALSE, warning=FALSE}
pr_fit1 <- pr_exp %>%
  model(Holt = ETS(Exports ~ error('A') + trend('A') + season('N')))

report(pr_fit1)

pr_fit1 %>% 
  accuracy()
```

Compare the forecasts from both methods. Which do you think is best?
```{r message=FALSE, warning=FALSE}
pr_exp %>% 
  model(SES = ETS(Exports ~ error('A') + trend('N') + season('N')),
        Holt = ETS(Exports ~ error('A') + trend('A') + season('N'))) %>% 
  accuracy()

pr_exp %>% 
  model(SES = ETS(Exports ~ error('A') + trend('N') + season('N')),
        Holt = ETS(Exports ~ error('A') + trend('A') + season('N'))) %>%
  forecast(h = 5) %>% 
  autoplot(pr_exp)
```



Calculate a 95% prediction interval for the first forecast for each model, using the RMSE values and assuming normal errors. Compare your intervals with those produced using R.
```{r message=FALSE, warning=FALSE}
pr_fc <- pr_fit %>%
  forecast(h = 5)

pr_fc_s <- sd(augment(pr_fit)$.resid)

pr_lower_limit <- pr_fc$.mean[1] - (pr_fc_s*1.96)
pr_upper_limit <- pr_fc$.mean[1] + (pr_fc_s*1.96)

cat(pr_lower_limit, pr_upper_limit)

pr_fc_hilo <- pr_fc %>%
  hilo()

pr_fc_hilo$`95%`[1]
```

Above is the comparison using the SES model.

```{r message=FALSE, warning=FALSE}
pr_fc1 <- pr_fit1 %>%
  forecast(h = 5)

pr_fc_s1 <- sd(augment(pr_fit1)$.resid)

pr1_lower_limit <- pr_fc1$.mean[1] - (pr_fc_s1*1.96)
pr1_upper_limit <- pr_fc1$.mean[1] + (pr_fc_s1*1.96)

cat(pr1_lower_limit, pr1_upper_limit)

pr_fc_hilo1 <- pr_fc1 %>%
  hilo()

pr_fc_hilo1$`95%`[1]
```

Above is the comparison using the Holt model.



## Exercise 6
Forecast the Chinese GDP from the `global_economy` data set using an ETS model. Experiment with the various options in the `ETS()` function to see how much the forecasts change with damped trend, or with a Box-Cox transformation. Try to develop an intuition of what each is doing to the forecasts.

[Hint: use a relatively large value of `h` when forecasting, so you can clearly see the differences between the various options when plotting the forecasts.]
```{r message=FALSE, warning=FALSE}
china_GDP <- global_economy %>%
  filter(!is.na(Population)) %>% 
  filter(Country == 'China')

china_GDP %>%
  autoplot(GDP) +
  labs(title = 'China GDP')

cfit <- china_GDP %>%
  model(SES = ETS(GDP ~ error('A') + trend('N') + season('N')),
        Holt = ETS(GDP ~ error('A') + trend('A') + season('N')),
        Damped = ETS(GDP ~ error('A') + trend('Ad') + season('N')))

cfit %>%
  accuracy()

cfit %>%
  forecast(h = 20) %>%
  autoplot(china_GDP) +
  labs(title = 'China GDP Forecast')
```



## Exercise 7
Find an ETS model for the Gas data from `aus_production` and forecast the next few years. Why is multiplicative seasonality necessary here? Experiment with making the trend damped. Does it improve the forecasts?
```{r message=FALSE, warning=FALSE}
gas <- aus_production %>%
  filter(!is.na(Gas)) %>% 
  select(Gas)

autoplot(gas, Gas) +
  labs(title = 'Gas Production')

gfit <- gas %>%
  model(add = ETS(Gas ~ error('A') + trend('A') + season('A')),
        mult = ETS(Gas ~ error('M') + trend('A') + season('M')),
        mult_damp = ETS(Gas ~ error('M') + trend('Ad') + season('M')))

gfit %>%
  forecast(h = 20) %>%
  autoplot(gas %>% 
             filter(year(Quarter) >= 1990)) +
  labs(title = 'Gas Production Forecast')

gfit %>% 
  accuracy()
```



## Exercise 8
Recall your retail time series data (from Exercise 7 in Section 2.10).
```{r message=FALSE, warning=FALSE}
set.seed(1)
myseries <- aus_retail %>% 
  filter(`Series ID` == sample(aus_retail$`Series ID`,1))

autoplot(myseries) +
  labs(title = 'Retail Turnovers')
```

Why is multiplicative seasonality necessary for this series?



Apply Holt-Winters’ multiplicative method to the data. Experiment with making the trend damped.
```{r message=FALSE, warning=FALSE}
mfit <- myseries %>%
  model(mult = ETS(Turnover ~ error('M') + trend('A') + season('M')),
        mult_damp = ETS(Turnover ~ error('M') + trend('Ad') + season('M')))

mfit %>%
  forecast(h = 60) %>%
  autoplot(myseries) +
  labs(title = 'Retail Turnovers Forecast')
```

Compare the RMSE of the one-step forecasts from the two methods. Which do you prefer?
```{r message=FALSE, warning=FALSE}
mfit %>% 
  accuracy()
```



Check that the residuals from the best method look like white noise.
```{r message=FALSE, warning=FALSE}
mfit1 <- myseries %>%
  model(mult = ETS(Turnover ~ error('M') + trend('A') + season('M')))

mfit1 %>% gg_tsresiduals()
```

Now find the test set RMSE, while training the model to the end of 2010. Can you beat the seasonal naïve approach from Exercise 7 in Section 5.11?
```{r message=FALSE, warning=FALSE}
myseries_train <- myseries %>% 
  filter(year(Month) < 2011)

mfit_sn <- myseries_train %>% 
  model(SNAIVE(Turnover))

fc <- mfit_sn %>% 
  forecast(new_data = anti_join(myseries, myseries_train))
fc %>%
  autoplot(myseries)
```



## Exercise 9
For the same retail data, try an STL decomposition applied to the Box-Cox transformed series, followed by ETS on the seasonally adjusted data. How does that compare with your best previous forecasts on the test set?
```{r message=FALSE, warning=FALSE}

```


